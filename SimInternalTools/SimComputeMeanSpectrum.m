function [R_res,S_res] = SimComputeMeanSpectrum(Simin,xmin,xmax,ymin,ymax)% [R_res,S_res] = Sim_ComputeMeanSpectrum(Simin,xmin,xmax,ymin,ymax)%% Compute the average spectrum in a region of a hyperspectral% image.%% 10/28/98	dhb		Added comments.%						dhb		Changed name to SimComputeMeanSpectrum% Standard simulator file read  if (isstruct(Simin))  Simin = Simin;else  Simin = SimReadImage(Simin); end% Check that input type is OKif (Simin.imageType~='hyperspectral')  error('Require hyperspectral images');end% Pass back old style S_res for other routines to use.% This is spectral sampling format used by the % Psychophysics Toolbox.S_res = [Simin.wavelengthSampling.start Simin.wavelengthSampling.step Simin.wavelengthSampling.numberSamples];% Process the images%h=waitbar(0,'Processing HyperImages...');prevDir = pwd;eval(['cd(''' Simin.rawImageDir ''');']);for l = 0 : Simin.wavelengthSampling.numberSamples-1	% Update the wait bar%  waitbar(l/(Simin.wavelengthSampling.numberSamples-1));  % Read one plane  fname = [Simin.imageRoot num2str(400+l*10)];  % Read the image, pull out appropriate section, calculate mean.  x = SimReadRawImage(fname,Simin.height,Simin.width);  xx = x(xmin:xmax,ymin:ymax);  R_res(l+1) = mean(mean(xx))*Simin.imageFactors(l+1);  clear x;end%close(h);eval(['cd(''' prevDir ''');']);