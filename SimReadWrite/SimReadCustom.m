function theStruct = SimReadCustom(file,theStruct,buf)% theStruct = SimReadCustom(file,theStruct,[buf])%% Add custom fields to the structure, and the% trailing comment.%% This routine is common to all our file formats% (camera, monitor, image).%% 1/14/99  dhb  Wrote it.% 1/19/99  dhb  Pull out read guts into subfunction.%          dhb  Clear numberAlgorithms if none are read.% 3/10/99  dhb  Return after comments are read.% Copyright (c) 1999 David Brainard and Philippe Longere.   All rights reserved.% Read custom fields.  These include algorithms for simulating% the camera and data required by the algorithms.if (nargin < 3)  buf=SimGetl(file);endtheStruct.numberAlgorithms = 0;while (~feof(file) & ~strncmp(buf,'#SimComments',12))  [theStruct,buf] = SimReadCustomField(file,theStruct,buf);endif (theStruct.numberAlgorithms == 0)  theStruct = rmfield(theStruct,'numberAlgorithms');end% Read any comments that should go into the data structure.if (strncmp(buf,'#SimComments',12))  theStruct.comments = '';  eval(['buf  = fscanf(file,''%s'',1);']);  while (~strncmp(buf,'#SimEndComments',15))    theStruct.comments = [theStruct.comments buf ' '];    eval(['buf  = fscanf(file,''%s'',1);']);  end  theStruct.comments = deblank(theStruct.comments);  return;end