function areEqual = SimEqualImage(image1,image2)% areEqual = SimEqualImage(image1,image2)%% Are two image structs equal?%% Differs from builtin function isequal in% that it ignores small precision errors in% certain data, doesn't care about order% of fields in struct, and ignores certain% fields.%% 3/1/99  dhb  Wrote it.% 6/26/02 dhb  Fix removal of rawImageDir, imageRoot.  Check both images for existence.% Copyright (c) 1999 David Brainard and Philippe Longere.   All rights reserved.areEqual = 1;% Don't care if rawImageDir and imageRoot differ.if (isfield(image1,'rawImageDir'))	image1 = rmfield(image1,'rawImageDir');endif (isfield(image2,'rawImageDir'))	image2 = rmfield(image2,'rawImageDir');endif (isfield(image1,'imageRoot'))	image1 = rmfield(image1,'imageRoot');endif (isfield(image2,'imageRoot'))	image2 = rmfield(image2,'imageRoot');end% If there is an imageFactors field,% only compare to a tolerancetol = 1e-8;if (isfield(image1,'imageFactors'))	check1 = image1.imageFactors;	check2 = image2.imageFactors;	if (max(abs(check1(:)-check2(:))) > tol)		areEqual = 0;		return	end	image1 = rmfield(image1,'imageFactors');	image2 = rmfield(image2,'imageFactors');end% If there is an images field,% only compare to a tolerancetol = 1e-8;if (isfield(image1,'images'))	check1 = image1.images;	check2 = image2.images;	if (max(abs(check1(:)-check2(:))) > tol)		areEqual = 0;		return	end	image1 = rmfield(image1,'images');	image2 = rmfield(image2,'images');end% Handle case of camera as structtol = 1e-8;if (isfield(image1,'cameraFile'))	if (isstruct(image1.cameraFile))		if (~SimEqualCamera(image1.cameraFile,image2.cameraFile))			areEqual = 0;			return;		end	end	image1 = rmfield(image1,'cameraFile');	image2 = rmfield(image2,'cameraFile');end% Handle case of monitor as structtol = 1e-8;if (isfield(image1,'monitorFile'))	if (isstruct(image1.monitorFile))		if (~SimEqualMonitor(image1.monitorFile,image2.monitorFile))			areEqual = 0;			return;		end	end	image1 = rmfield(image1,'monitorFile');	image2 = rmfield(image2,'monitorFile');end% Compare remaining fields, but don't care% about order.names1 = sort(fieldnames(image1));names2 = sort(fieldnames(image2));if (length(names1) ~= length(names2))	areEqual = 0;	return;endfor i = 1:length(names1)	if (eval(['~isequal(image1.' names1{i} ',image2.' names2{i} ')']))		areEqual = 0;		return;	endend